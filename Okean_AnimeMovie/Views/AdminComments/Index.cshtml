@model IEnumerable<Okean_AnimeMovie.Core.Entities.Comment>
@{
    ViewData["Title"] = "Duyệt bình luận";
    var animes = ViewBag.Animes as List<Okean_AnimeMovie.Core.Entities.Anime>;
}

<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="mb-0"><i class="bi bi-chat-dots me-2"></i>Duyệt bình luận</h2>
        <a asp-controller="Admin" asp-action="Dashboard" class="btn btn-outline-secondary"><i class="bi bi-arrow-left me-2"></i>Quay lại</a>
    </div>

    <form method="get" class="card border-0 shadow-sm rounded-4 mb-3">
        <div class="card-body row g-3 align-items-end">
            <div class="col-md-4">
                <label class="form-label">Anime</label>
                <select name="animeId" class="form-select">
                    <option value="">Tất cả</option>
                    @foreach (var a in animes ?? new())
                    {
                        <option value="@a.Id" selected="@(ViewBag.FilterAnimeId == a.Id)">@a.Title</option>
                    }
                </select>
            </div>
            <div class="col-md-4">
                <label class="form-label">Người dùng</label>
                <input name="userName" class="form-control" value="@ViewBag.FilterUserName" placeholder="Tên đăng nhập" />
            </div>
            <div class="col-md-2">
                <div class="form-check mt-4">
                    <input class="form-check-input" type="checkbox" name="onlyHidden" value="true" @(ViewBag.OnlyHidden ? "checked" : "") id="onlyHidden">
                    <label class="form-check-label" for="onlyHidden">Chỉ hiển thị đã ẩn</label>
                </div>
            </div>
            <div class="col-md-2 text-end">
                <button class="btn btn-primary"><i class="bi bi-search me-2"></i>Lọc</button>
            </div>
        </div>
    </form>

    <div class="card border-0 shadow-sm rounded-4">
        <div class="table-responsive">
            <table class="table align-middle mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Anime</th>
                        <th>Người dùng</th>
                        <th>Nội dung</th>
                        <th>Trạng thái</th>
                        <th>Thời gian</th>
                        <th class="text-end" style="width: 260px;">Hành động</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var c in Model)
                    {
                        <tr>
                            <td class="text-truncate" style="max-width: 220px;">
                                <a asp-controller="Anime" asp-action="Details" asp-route-id="@c.AnimeId" class="text-decoration-none">@c.Anime.Title</a>
                            </td>
                            <td>@c.User.UserName</td>
                            <td class="text-truncate" style="max-width: 420px;">@c.Content</td>
                            <td>
                                @if (c.IsActive)
                                {<span class="badge bg-success">Hiển thị</span>}
                                else
                                {<span class="badge bg-secondary">Đã ẩn</span>}
                            </td>
                            <td><small class="text-muted">@c.CreatedAt.ToLocalTime().ToString("dd/MM/yyyy HH:mm")</small></td>
                            <td class="text-end">
                                @if (c.IsActive)
                                {
                                    <form class="d-inline" asp-action="Hide" method="post" asp-route-id="@c.Id">
                                        @Html.AntiForgeryToken()
                                        <button type="submit" class="btn btn-sm btn-outline-secondary"><i class="bi bi-eye-slash me-1"></i>Ẩn</button>
                                    </form>
                                }
                                else
                                {
                                    <form class="d-inline" asp-action="Show" method="post" asp-route-id="@c.Id">
                                        @Html.AntiForgeryToken()
                                        <button type="submit" class="btn btn-sm btn-outline-success"><i class="bi bi-eye me-1"></i>Hiển</button>
                                    </form>
                                }
                                <form class="d-inline" asp-action="SoftDelete" method="post" asp-route-id="@c.Id">
                                    @Html.AntiForgeryToken()
                                    <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Xóa mềm bình luận này?');"><i class="bi bi-trash me-1"></i>Xóa mềm</button>
                                </form>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>
